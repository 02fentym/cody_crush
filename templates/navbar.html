<div class="flex justify-between items-center bg-base-100 px-6 py-2 drop-shadow-xl">
  <!-- Left: Logo -->
  <div>
    <a class="btn btn-ghost normal-case text-xl" href="{% url 'home' %}">CodeX</a>
  </div>

  <!-- Center: Nav links -->
  <div class="hidden md:flex gap-8 justify-between">
    <a class="btn btn-ghost btn-lg rounded-btn">Course</a>
    <a class="btn btn-ghost btn-lg rounded-btn">Students</a>
    <a class="btn btn-ghost btn-lg rounded-btn">Settings</a>
  </div>

  <!-- Right: Theme toggle + User dropdown -->
  <div class="flex items-center gap-4">
    <!-- Theme Selector Dropdown -->
    <select id="theme-select" class="select select-bordered select-sm w-40">
      <option disabled value="">Select Theme</option>

      <optgroup label="Light Themes">
        <option value="light">Light</option>
        <option value="lofi">Lofi</option>
        <option value="wireframe">Wireframe</option>
        <option value="cmyk">CMYK</option>
      </optgroup>

      <optgroup label="Dark Themes">
        <option value="dark">Dark</option>
        <option value="halloween">Halloween</option>
        <option value="forest">Forest</option>
        <option value="black">Black</option>
        <option value="dracula">Dracula</option>
        <option value="business">Business</option>
      </optgroup>
    </select>



    <!-- User Dropdown -->
    <div class="dropdown dropdown-end">
      <label tabindex="0" class="flex items-center gap-2 cursor-pointer">
        <div class="w-8 h-8 bg-neutral text-neutral-content rounded-full flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"
            stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 
              7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 
              0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 
              21a8.966 8.966 0 0 1-5.982-2.275M15 
              9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>
        </div>
        <span class="text-white text-sm">{{ user.username }}</span>
      </label>

      <ul tabindex="0" class="dropdown-content mt-3 z-50 menu p-2 shadow bg-base-100 rounded-box w-40">
        <li><a href="#">Settings</a></li>
        <li><a href="{% url 'logout' %}">Logout</a></li>
      </ul>
    </div>
  </div>
</div>


<!-- Theme Toggle Script -->
<script>
  const html = document.documentElement;
  const select = document.getElementById("theme-select");

  function setTheme(theme) {
    if (!theme || theme === "auto") {
      theme = "light";
    }

    html.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
    if (select) select.value = theme;

    // Save to server
    fetch("/update-theme/", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
      },
      body: `theme=${encodeURIComponent(theme)}`
    });
  }

  const validThemes = [
    "light", "lofi", "wireframe", "cmyk",
    "dark", "halloween", "forest", "black", "dracula", "business"
  ];

  const saved = localStorage.getItem("theme");
  if (validThemes.includes(saved)) {
    setTheme(saved);
  } else if (!saved || saved === "") {
    const fallback = "{{ request.user.profile.theme|default:'light' }}";
    setTheme(fallback);
  } else {
    setTheme("light");
  }


  if (select) {
    select.addEventListener("change", () => {
      setTheme(select.value);
    });
  }
</script>
