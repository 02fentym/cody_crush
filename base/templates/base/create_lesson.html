{% extends "main.html" %}

{% block content %}

<h2>Create Lesson</h2>

<form method="POST" style="margin-top: 20px;">
    {% csrf_token %}

    {# --- Non-field errors (form-wide errors) --- #}
    {% if form.non_field_errors %}
    <div style="color: red; margin-bottom: 10px;">
        {{ form.non_field_errors }}
    </div>
    {% endif %}

    {# --- Title Field --- #}
    <label for="{{ form.title.id_for_label }}" style="display: block; font-weight: bold; margin-bottom: 4px;">Title:</label>
    {{ form.title }}
    {% if form.title.errors %}
    <div style="color: red; margin-top: 4px;">{{ form.title.errors }}</div>
    {% endif %}
    <br><br>

    {# --- Markdown Editor --- #}
    <label for="editor" style="display: block; font-weight: bold; margin-bottom: 4px;">Content (Markdown):</label>
    <div id="editor"></div>

    {# --- Hidden textarea that will be submitted --- #}
    <textarea id="id_content" name="content" style="display:none;">{{ form.content.value|default_if_none:"" }}</textarea>
    {% if form.content.errors %}
    <div style="color: red; margin-top: 4px;">{{ form.content.errors }}</div>
    {% endif %}

    <br>
    <button type="submit"
        style="padding: 6px 12px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; font-weight: bold;">
        Create
    </button>
    <button type="button" onclick="window.history.back()"
        style="padding: 6px 12px; margin-left: 10px; background-color: #ccc; border: none; border-radius: 4px;">
        Cancel
    </button>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const { Editor } = toastui;
        const { codeSyntaxHighlight } = Editor.plugin;

        const editor = new Editor({
            el: document.querySelector('#editor'),
            height: '500px',
            initialEditType: 'markdown',
            previewStyle: 'vertical',
            initialValue: document.getElementById('id_content').value,
            plugins: [codeSyntaxHighlight],
            toolbarItems: [
                ['heading', 'bold', 'italic', 'strike'],
                ['hr', 'quote'],
                ['ul', 'ol', 'task'],
                ['table', 'link', 'image'],
                ['code', 'codeblock'],
                ['scrollSync']
            ]
        });

        document.querySelector('form').addEventListener('submit', function () {
            document.getElementById('id_content').value = editor.getMarkdown();
        });
    });
</script>

{% endblock %}
