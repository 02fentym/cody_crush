{% extends "main.html" %}

{% block content %}

<h5><a href="{% url 'home' %}">Dashboard</a> > <a href="{% url 'course' topic.unit.course.id %}">
        {{ topic.unit.course.title }}</a> > <a href="{% url 'unit' topic.unit.course.id topic.unit.id %}">
        {{ topic.unit.title }}</a> > {{ topic.title }}</h5>

<h2>Topic: {{topic.title}}</h2>


<div>
    <h3>Topic Activities</h3>

    {% if activities %}
    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 16px;">
        {% for activity in activities %}
        <div
            style="border: 1px solid #ddd; border-radius: 8px; padding: 16px; min-width: 200px; background-color: #fefefe; text-align: center;">

            <!-- Lesson Card -->
            {% if activity.type == "lesson" and activity.lesson %}
            <div style="font-size: 1.1em; font-weight: bold;">
                {{ activity.lesson.title }}
            </div>
            <div style="color: #666; margin-top: 8px;">üìò Lesson</div>
            <a href="#" style="margin-top: 12px; display: inline-block;">View</a>

            <!-- Quiz Card -->
            {% elif activity.type == "quiz" and activity.quiz_template %}
            
            {% if request.user.profile.role == "student" %}
            <a href="{% url 'start-quiz' activity.id %}">
                <div style="font-size:1.1em; font-weight:bold;">Quiz</div>
                <div style="color:#666; margin-top:8px;">
                    {{ activity.quiz_template.question_count }} Questions
                </div>
            </a>
            {% else %}
            <div style="font-size:1.1em; font-weight:bold; cursor: default;">
                Quiz
            </div>
            <div style="color:#666; margin-top:8px;">
                {{ activity.quiz_template.question_count }} Questions
            </div>
            {% endif %}

            <!-- Unknown Card -->
            {% else %}
            <div style="color: #888;">‚ö†Ô∏è Unknown activity type.</div>
            {% endif %}

            {% if request.user.profile.role == "teacher" %}
            <form method="POST" action="{% url 'delete-activity' activity.id %}" style="margin-top: 8px;">
                {% csrf_token %}
                <button type="submit"
                    style="border: none; background: none; color: #c00; cursor: pointer; font-size: 0.9em;">
                    üóë
                </button>
            </form>
            {% endif %}

        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="color: #777;">No activities yet.</p>
    {% endif %}
</div>



{% if request.user.profile.role == "teacher" %}
<div style="display: flex; gap: 24px; margin-top: 20px; flex-wrap: wrap;">

    <!-- Create Lesson Card -->
    <div style="border: 1px solid #ccc; padding: 16px; border-radius: 8px; background-color: #f9f9f9; width: 280px;">
        <h4 style="margin-top: 0;">Create a Lesson</h4>
        <p style="font-size: 0.9em; color: #555;">Add a new lesson with content for students to study before their
            quiz.</p>

        <a href="{% url 'create-lesson' topic.id %}" class="btn"
            style="display: inline-block; padding: 8px 14px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">
            Create Lesson
        </a>
    </div>

    <!-- Create Quiz Card -->
    <div style="border: 1px solid #ccc; padding: 16px; border-radius: 8px; background-color: #f9f9f9; width: 280px;">
        <h4 style="margin-top: 0;">Create a Quiz</h4>
        <p style="font-size: 0.9em; color: #555;">Generate a quiz from the topic's question pool. Students will
            receive randomized questions.</p>

        <form method="POST" action="{% url 'create-quiz' topic.id %}"
            style="display: flex; flex-direction: column; gap: 10px;">
            {% csrf_token %}
            <input type="hidden" name="form-type" value="quiz">

            <label for="question_count" style="font-size: 0.9em;">Number of Questions:</label>
            <select name="question_count" id="question_count" style="padding: 6px; border-radius: 4px;">
                <option value="5" selected>5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20">20</option>
            </select>

            <button type="submit"
                style="padding: 8px 14px; background-color: #2196F3; color: white; border: none; border-radius: 6px; font-weight: bold;">
                Create Quiz
            </button>
        </form>
    </div>
</div>
{% endif %}

{% endblock %}