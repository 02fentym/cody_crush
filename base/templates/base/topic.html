{% extends "main.html" %}

{% block content %}

<h5><a href="{% url 'home' %}">Dashboard</a> > <a href="{% url 'course' topic.unit.course.id %}">
        {{ topic.unit.course.title }}</a> > <a href="{% url 'unit' topic.unit.course.id topic.unit.id %}">
        {{ topic.unit.title }}</a> > {{ topic.title }}</h5>

<h2>Topic: {{topic.title}}</h2>


<div>
    <h3>Topic Activities</h3>

    {% if activities %}
    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 16px;">
        {% for activity in activities %}
        <div
            style="border: 1px solid #ddd; border-radius: 8px; padding: 16px; min-width: 200px; background-color: #fefefe; text-align: center;">

            {% with activity.content_object as content_object %}

            <!-- Lesson Card -->
            {% if activity.content_type.model == "lesson" and content_object %}

            {% if request.user.profile.role == "student" %}
            <a href="{% url 'view-lesson' content_object.id %}" style="margin-top: 12px; display: inline-block;">
                <div style="font-size: 1.1em; font-weight: bold;">Lesson</div>
                <div style="color: #666; margin-top: 8px;">{{ content_object.title|striptags }}</div>
            </a>
            {% else %}
            <div style="font-size: 1.1em; font-weight: bold;">Lesson</div>
            <div style="color: #666; margin-top: 8px;">{{ content_object.title|striptags }}</div>
            <a href="{% url 'edit-lesson' activity.topic.id content_object.id %}"
                style="margin-top: 12px; display: inline-block;">Edit</a>
            {% endif %}

            <!-- Dmoj Exerdcise Card -->
            {% elif activity.content_type.model == "dmojexercise" and content_object %}
            <div style="font-size: 1.1em; font-weight: bold;">DMOJ Exercise</div>
            <div style="color: #666; margin-top: 8px;">{{ content_object.title }}</div>


            <!-- Quiz Card -->
            {% elif activity.content_type.model == "quiztemplate" and content_object %}

            {% if request.user.profile.role == "student" %}
            <a href="{% url 'start-quiz' activity.id %}">
                <div style="font-size: 1.1em; font-weight: bold;">
                    {% if content_object.question_type == "multiple_choice" %}
                    Multiple Choice Quiz
                    {% elif content_object.question_type == "tracing" %}
                    Tracing Quiz
                    {% else %}
                    Unknown Quiz Type
                    {% endif %}
                </div>
                <div style="color: #666; margin-top: 8px;">
                    Questions: {{ content_object.question_count }}
                </div>
            </a>
            {% else %}
            <div style="font-size: 1.1em; font-weight: bold; cursor: default;">
                {% if content_object.question_type == "multiple_choice" %}
                Multiple Choice Quiz
                {% elif content_object.question_type == "tracing" %}
                Tracing Quiz
                {% else %}
                Unknown Quiz Type
                {% endif %}
            </div>

            <div style="color: #666; margin-top: 8px;">
                Questions: {{ content_object.question_count }}
            </div>
            {% endif %}

            <!-- Unknown Card -->
            {% else %}
            <div style="color: #888;">‚ö†Ô∏è Unknown activity type.</div>
            {% endif %}

            {% endwith %}

            {% if request.user.profile.role == "teacher" %}
            <form method="POST" action="{% url 'delete-activity' activity.id %}" style="margin-top: 8px;">
                {% csrf_token %}
                <button type="submit"
                    style="border: none; background: none; color: #c00; cursor: pointer; font-size: 0.9em;">
                    üóë
                </button>
            </form>
            {% endif %}

        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="color: #777;">No activities yet.</p>
    {% endif %}
</div>



{% if request.user.profile.role == "teacher" %}
<div style="display: flex; gap: 24px; margin-top: 20px; flex-wrap: wrap;">

    <!-- Create Lesson Card -->
    <div style="border: 1px solid #ccc; padding: 16px; border-radius: 8px; background-color: #f9f9f9; width: 280px;">
        <h4 style="margin-top: 0;">Create a Lesson</h4>
        <p style="font-size: 0.9em; color: #555;">Add a new lesson with content for students to study before their
            quiz.</p>

        <a href="{% url 'create-lesson' topic.id %}" class="btn"
            style="display: inline-block; padding: 8px 14px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">
            Submit
        </a>
    </div>

    <!-- Create Dmoj Exercise Card -->
    <div style="border: 1px solid #ccc; padding: 16px; border-radius: 8px; background-color: #f9f9f9; width: 280px;">
        <h4 style="margin-top: 0;">Create a Dmoj Exercise</h4>
        <p style="font-size: 0.9em; color: #555;">Assign a DMOJ exercise.</p>

        <form method="POST" action="{% url 'create-dmoj-exercise' topic.id %}">
            {% csrf_token %}
            <input type="hidden" name="form-type" value="dmoj">

            <label for="url" style="font-size: 0.9em;">DMOJ URL:</label><br>
            <input type="text" name="url" id="url" placeholder="https://dmoj.ca/problem/abc123"
                style="width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #ccc; margin-top: 4px;"><br><br>

            <button type="submit"
                style="padding: 8px 14px; background-color: #2196F3; color: white; border: none; border-radius: 6px; font-weight: bold;">
                Submit
            </button>
        </form>
    </div>

    <!-- Create Quiz Card -->
    <div style="border: 1px solid #ccc; padding: 16px; border-radius: 8px; background-color: #f9f9f9; width: 280px;">
        <h4 style="margin-top: 0;">Create a Quiz</h4>
        <p style="font-size: 0.9em; color: #555;">Generate a quiz from the topic's question pool. Students will
            receive randomized questions.</p>

        <form method="POST" action="{% url 'create-quiz' topic.id %}"
            style="display: flex; flex-direction: column; gap: 10px;">
            {% csrf_token %}
            <input type="hidden" name="form-type" value="quiz">

            <label for="question_count" style="font-size: 0.9em;">Number of Questions:</label>
            <select name="question_count" id="question_count" style="padding: 6px; border-radius: 4px;">
                <option value="5" selected>5</option>
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20">20</option>
            </select>

            <label for="question_type" style="font-size: 0.9em;">Question Type:</label>
            <select name="question_type" id="question_type" style="padding: 6px; border-radius: 4px;">
                <option value="multiple_choice" selected>Multiple Choice</option>
                <option value="tracing">Tracing</option>
            </select>

            <button type="submit"
                style="padding: 8px 14px; background-color: #2196F3; color: white; border: none; border-radius: 6px; font-weight: bold;">
                Submit
            </button>
        </form>
    </div>
</div>
{% endif %}

{% endblock %}