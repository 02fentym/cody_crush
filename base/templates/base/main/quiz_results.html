{% extends "main.html" %}

{% block content %}
<h2>{{ quiz_template.course_topic.topic.title }} Quiz</h2>

<p><strong>Score:</strong> {{ quiz.grade }}%</p>

{% for answer in answers %}
<div class="quiz-result">
    <p><strong>{{ forloop.counter }}. {{ answer.quiz_question.question.prompt|safe }}</strong></p>

    {% if quiz_template.question_type == "multiple_choice" %}
    <div class="space-y-1 ml-4">
        <div
            class="px-2 py-1 rounded
        {% if answer.quiz_question.question.correct_choice == 'a' %} border border-green-500 text-green-800 bg-green-200 {% endif %}
        {% if answer.selected_choice == 'a' and not answer.is_correct %} border border-error text-error bg-error/10 {% endif %}">
            a) {{ answer.quiz_question.question.choice_a|safe }}
        </div>

        <div
            class="px-2 py-1 rounded
        {% if answer.quiz_question.question.correct_choice == 'b' %} border border-green-500 text-green-800 bg-green-200 {% endif %}
        {% if answer.selected_choice == 'b' and not answer.is_correct %} border border-error text-error bg-error/10 {% endif %}">
            b) {{ answer.quiz_question.question.choice_b|safe }}
        </div>

        <div
            class="px-2 py-1 rounded
        {% if answer.quiz_question.question.correct_choice == 'c' %} border border-green-500 text-green-800 bg-green-200 {% endif %}
        {% if answer.selected_choice == 'c' and not answer.is_correct %} border border-error text-error bg-error/10 {% endif %}">
            c) {{ answer.quiz_question.question.choice_c|safe }}
        </div>

        <div
            class="px-2 py-1 rounded
        {% if answer.quiz_question.question.correct_choice == 'd' %} border border-green-500 text-green-800 bg-green-200 {% endif %}
        {% if answer.selected_choice == 'd' and not answer.is_correct %} border border-error text-error bg-error/10 {% endif %}">
            d) {{ answer.quiz_question.question.choice_d|safe }}
        </div>
    </div>





    <p>Your answer: {{ answer.selected_choice }}</p>
    <p>Correct answer: {{ answer.quiz_question.question.correct_choice }}</p>

    {% if answer.is_correct %}
    <span class="correct-text">✅ Correct</span>
    {% else %}
    <span class="incorrect-text">❌ Incorrect</span>
    {% endif %}

    {% elif quiz_template.question_type == "tracing" %}
    <p>Your answer:</p>
    <pre>{{ answer.text_answer|safe }}</pre>

    <p>Expected output:</p>
    <pre>{{ answer.quiz_question.question.expected_output|safe }}</pre>

    {% if answer.is_correct %}
    <span class="correct-text">✅ Correct</span>
    {% else %}
    <span class="incorrect-text">❌ Incorrect</span>
    {% endif %}
    {% endif %}

    <button type="button" onclick="toggleExplanation('{{ forloop.counter0 }}', this)" class="link-button"
        style="font-size: 0.9em;">
        Show Explanation
    </button>

    <div id="explanation-{{ forloop.counter0 }}" class="explanation-box">
        {{ answer.quiz_question.question.explanation|linebreaksbr }}
    </div>

    <hr>
</div>
{% endfor %}

<div style="margin-top: 24px;">
    <a href="{% url 'course' course_id %}" class="back-button">
        ← Back to Course
    </a>
</div>

{% endblock %}